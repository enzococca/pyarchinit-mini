{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>{{ title }}</h2>

    <form method="POST" class="mt-4">
        {{ form.hidden_tag() }}

        <div class="mb-3">
            <label class="form-label">{{ _('Site') }}</label>
            {{ form.sito(class="form-control", required=True) }}
        </div>

        <div class="mb-3">
            <label class="form-label">{{ _('Country') }}</label>
            {{ form.nazione(class="form-control") }}
        </div>

        <div class="mb-3">
            <label class="form-label">{{ _('Region') }}</label>
            {{ form.regione(class="form-control") }}
        </div>

        <div class="mb-3">
            <label class="form-label">{{ _('Municipality') }}</label>
            {{ form.comune(class="form-control") }}
        </div>

        <div class="mb-3">
            <label class="form-label">{{ _('Province') }}</label>
            {{ form.provincia(class="form-control") }}
        </div>

        <div class="mb-3">
            <label class="form-label">{{ _('Site Definition') }}</label>
            {{ form.definizione_sito(class="form-control") }}
        </div>

        <div class="mb-3">
            <label class="form-label">{{ _('Description') }}</label>
            {{ form.descrizione(class="form-control", rows=5) }}
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-primary">{{ _('Save') }}</button>
            <a href="{{ url_for('sites_list') }}" class="btn btn-secondary">{{ _('Cancel') }}</a>
        </div>
    </form>

    <!-- Media Files Section (only in edit mode) -->
    {% if edit_mode and site_id %}
    <div class="card mt-4">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-photo-video"></i> {{ _('Media Files') }}
            </h5>
            <a href="{{ url_for('upload_media') }}?entity_type=site&entity_id={{ site_id }}"
               class="btn btn-sm btn-light">
                <i class="fas fa-upload"></i> {{ _('Upload Media') }}
            </a>
        </div>
        <div class="card-body">
            {% if media_list %}
            <div class="row">
                {% for media in media_list %}
                <div class="col-md-3 mb-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            {% if media.media_type == 'image' and media.media_path %}
                                <img src="/{{ media.media_path }}"
                                     alt="{{ media.media_name }}"
                                     class="img-fluid mb-2"
                                     style="max-height: 150px; object-fit: cover;"
                                     onerror="this.parentElement.innerHTML='<i class=\'fas fa-image fa-3x text-muted mb-2\'></i>'">
                            {% elif media.media_type == 'document' %}
                                <i class="fas fa-file-pdf fa-3x text-danger mb-2"></i>
                            {% elif media.media_type == 'video' %}
                                <i class="fas fa-video fa-3x text-primary mb-2"></i>
                            {% elif media.media_type == 'audio' %}
                                <i class="fas fa-music fa-3x text-info mb-2"></i>
                            {% elif media.media_type == '3d_model' %}
                                <i class="fas fa-cube fa-3x text-success mb-2"></i>
                            {% else %}
                                <i class="fas fa-file fa-3x text-secondary mb-2"></i>
                            {% endif %}
                            <p class="small mb-1"><strong>{{ media.media_name }}</strong></p>
                            {% if media.description %}
                            <p class="small text-muted mb-2">{{ media.description[:50] }}{% if media.description|length > 50 %}...{% endif %}</p>
                            {% endif %}
                            {% if media.is_primary %}
                            <span class="badge bg-success mb-2">{{ _('Primary') }}</span>
                            {% endif %}
                        </div>
                        <div class="card-footer text-center">
                            <div class="btn-group btn-group-sm">
                                <a href="/{{ media.media_path }}" target="_blank" class="btn btn-primary" title="{{ _('View') }}">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="/{{ media.media_path }}" download="{{ media.media_name }}" class="btn btn-success" title="{{ _('Download') }}">
                                    <i class="fas fa-download"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="alert alert-info mb-0">
                <i class="fas fa-info-circle"></i>
                {{ _('No media files have been uploaded for this site yet.') }}
                <a href="{{ url_for('upload_media') }}?entity_type=site&entity_id={{ site_id }}">
                    {{ _('Upload your first file') }}
                </a>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
